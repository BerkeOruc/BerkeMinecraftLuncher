#!/bin/bash

# BerkeMC - Advanced Minecraft Launcher
# Main Entry Point

VERSION="3.1.0"

# Check for version commands
if [ "$1" = "version" ] || [ "$1" = "--version" ] || [ "$1" = "-v" ]; then
    echo "🎮 BerkeMC v${VERSION}"
    echo "📦 Advanced Minecraft Launcher"
    echo "🔗 https://github.com/BerkeOruc/berkemc"
    exit 0
fi

# Check for reinstall command
if [ "$1" = "reinstall" ] || [ "$1" = "--reinstall" ]; then
    echo "🔄 BerkeMC Yeniden Kuruluyor..."
    echo ""
    echo "İşlemler:"
    echo "  1. Tüm ayar dosyaları silinecek"
    echo "  2. BerkeMC paketi kaldırılacak"
    echo "  3. BerkeMC yeniden kurulacak"
    echo "  ⚠️  Minecraft dizini (~/.minecraft/) korunacak"
    echo ""
    read -p "Devam etmek istiyor musunuz? (e/H): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Ee]$ ]]; then
        echo "🗑️  Ayar dosyaları siliniyor..."
        rm -rf ~/.berke_minecraft_launcher/
        echo "✅ Ayar dosyaları silindi!"
        
        echo "📦 Paket kaldırılıyor..."
        if command -v yay &> /dev/null; then
            yay -Rns berkemc --noconfirm 2>/dev/null
        elif command -v paru &> /dev/null; then
            paru -Rns berkemc --noconfirm 2>/dev/null
        elif command -v pacman &> /dev/null; then
            sudo pacman -Rns berkemc --noconfirm 2>/dev/null
        fi
        
        echo "📦 Yeniden kuruluyor..."
        if command -v yay &> /dev/null; then
            yay -S berkemc --noconfirm
        elif command -v paru &> /dev/null; then
            paru -S berkemc --noconfirm
        else
            echo "❌ Yay veya Paru bulunamadı!"
            exit 1
        fi
        
        echo "✅ BerkeMC başarıyla yeniden kuruldu!"
        echo "🎮 Şimdi 'berkemc' yazarak başlatabilirsiniz!"
    else
        echo "❌ Yeniden kurulum iptal edildi."
    fi
    exit 0
fi

# Check for uninstall command
if [ "$1" = "uninstall" ] || [ "$1" = "--uninstall" ]; then
    echo "🗑️  BerkeMC Kaldırılıyor..."
    echo ""
    echo "Kaldırılacak öğeler:"
    echo "  • BerkeMC paketi"
    echo "  • Ayar dosyaları: ~/.berke_minecraft_launcher/"
    echo "  • Minecraft sürümleri: ~/.berke_minecraft_launcher/versions/"
    echo "  ⚠️  Minecraft dizini (~/.minecraft/) korunacak"
    echo ""
    read -p "Devam etmek istiyor musunuz? (e/H): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Ee]$ ]]; then
        echo "📦 Paket kaldırılıyor..."
        
        # Uninstall package
        if command -v yay &> /dev/null; then
            yay -Rns berkemc --noconfirm
        elif command -v paru &> /dev/null; then
            paru -Rns berkemc --noconfirm
        elif command -v pacman &> /dev/null; then
            sudo pacman -Rns berkemc --noconfirm
        else
            echo "❌ Paket yöneticisi bulunamadı!"
            exit 1
        fi
        
        # Ask to remove config
        echo ""
        read -p "Ayar dosyalarını da sil? (e/H): " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Ee]$ ]]; then
            echo "🗑️  Ayar dosyaları siliniyor..."
            rm -rf ~/.berke_minecraft_launcher/
            echo "✅ Ayar dosyaları silindi!"
        fi
        
        echo "✅ BerkeMC başarıyla kaldırıldı!"
    else
        echo "❌ Kaldırma iptal edildi."
    fi
    exit 0
fi

# Check for update command
if [ "$1" = "update" ] || [ "$1" = "--update" ]; then
    echo "🔄 BerkeMC güncelleniyor..."
    
    # Check if yay is available
    if command -v yay &> /dev/null; then
        echo "📦 Yay ile güncelleniyor..."
        yay -S berkemc --noconfirm
    elif command -v paru &> /dev/null; then
        echo "📦 Paru ile güncelleniyor..."
        paru -S berkemc --noconfirm
    else
        echo "❌ Yay veya Paru bulunamadı!"
        echo "💡 Manuel güncelleme: yay -S berkemc"
        exit 1
    fi
    
    echo "✅ Güncelleme tamamlandı!"
    exit 0
fi

# Check for help command
if [ "$1" = "help" ] || [ "$1" = "--help" ] || [ "$1" = "-h" ]; then
    echo "🎮 BerkeMC v${VERSION} - Advanced Minecraft Launcher"
    echo ""
    echo "Kullanım:"
    echo "  berkemc                    - Launcher'ı başlat"
    echo "  berkemc version, -v        - Sürüm bilgisi göster"
    echo "  berkemc update             - Son sürüme güncelle"
    echo "  berkemc reinstall          - Temiz kurulum (ayarlar sıfırlanır)"
    echo "  berkemc uninstall          - BerkeMC'yi kaldır"
    echo "  berkemc help, -h           - Bu yardım menüsünü göster"
    echo ""
    echo "Özellikler:"
    echo "  🚀 Ultra hızlı Minecraft launcher'ı"
    echo "  ☕ Otomatik Java yönetimi (Java 17-25)"
    echo "  📥 Paralel indirme sistemi (16 thread)"
    echo "  🎨 Skin yönetimi ve önizleme"
    echo "  🔧 Mod desteği (Forge, Fabric, OptiFine)"
    echo "  🖥️  Wayland/Hyprland tam desteği"
    echo "  🎯 Asset doğrulama ve otomatik onarım"
    echo "  📊 Performans izleme (FPS, RAM, CPU)"
    echo "  🌍 Çoklu dil desteği (TR/EN)"
    echo ""
    echo "Repo: https://github.com/BerkeOruc/berkemc"
    echo "AUR:  https://aur.archlinux.org/packages/berkemc"
    exit 0
fi

# Default: Start the launcher
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
cd "$SCRIPT_DIR" || exit 1
exec python3 "$SCRIPT_DIR/berke_minecraft_launcher.py" "$@"